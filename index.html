<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="images/logo-treevia.png">
    <title>Teste técnico Treevia - Vinicius Richter</title>
    <link rel="icon" type="image/png" href="images/logo-treevia.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <!-- Prism core CSS e tema -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

    <!-- Prism core JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>

    <!-- Suporte a Python -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-python.min.js"></script>

    <!-- Plugin de linhas -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.css"
        rel="stylesheet" />
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.js"></script>


    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }

        section {
            scroll-margin-top: 10vh;
        }

        .code-block {
            position: relative;
        }

        .copy-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .challenge-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .challenge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100">
    <!-- Fixed Header -->
    <!-- Fixed Header -->
    <header class="fixed top-0 left-0 right-0 bg-gray-800 shadow-lg z-50">
        <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row items-center justify-between">
            <!-- Logo / Title -->
            <h1
                class="text-2xl md:text-3xl font-bold font-mono text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 mb-2 md:mb-0">
                Teste técnico Treevia - Vinicius Richter </h1> <!-- Navigation -->
            <nav class="flex space-x-4 md:space-x-6 text-sm md:text-base"> <a href="#challenge1"
                    class="text-gray-300 hover:text-blue-400 transition-colors">Desafio 1</a> <a href="#challenge2"
                    class="text-gray-300 hover:text-green-400 transition-colors">Desafio 2</a> <a href="#challenge3"
                    class="text-gray-300 hover:text-yellow-400 transition-colors">Desafio 3</a> <a href="#mapa"
                    class="text-gray-300 hover:text-yellow-400 transition-colors">Mapa</a> <a href="#download"
                    class="text-gray-300 hover:text-yellow-400 transition-colors">Baixar aquivos</a> </nav>
        </div>
    </header>
    <!-- Main Content -->
    <main class="pt-24 pb-12 container mx-auto px-4">
        <!-- Challenge 1 -->
        <section id="challenge1" class="mb-16 challenge-card bg-gray-800 rounded-xl p-6">
            <div class="flex items-center mb-6">
                <div
                    class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mr-4">
                    <span class="text-xl font-bold">1</span>
                </div>
                <h2
                    class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">
                    Desafio #1
                </h2>
            </div>

            <div class="prose prose-invert max-w-none mb-8">
                <p class="text-gray-300 leading-relaxed">
                    Função que dado uma string com letras em um mesmo case (Maiúscula ou Minúscula) retorna os
                    buracos de caracteres faltantes de A-Z.
                </p>
            </div>

            <div class="code-block bg-gray-700 rounded-lg p-4 mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400 font-mono">Python</span>
                    <button onclick="copyCode('code1')"
                        class="bg-gray-600 hover:bg-gray-500 text-white py-1 px-3 rounded-md text-sm flex items-center transition-colors">
                        <i data-feather="copy" class="w-4 h-4 mr-2"></i> Copiar
                    </button>
                </div>
                <pre id="code1"
                    class="language-python line-numbers font-mono text-sm text-gray-200 overflow-x-auto p-4 bg-gray-800 rounded"><code>def desafio1(texto: str) -> str:
    if not texto:
        return ""

    tem_maiuscula = any(c.isupper() for c in texto)
    tem_minuscula = any(c.islower() for c in texto)
    
    if tem_maiuscula and tem_minuscula:
        case_referencia = texto[0].isupper()
        texto_filtrado = [c for c in texto if c.isupper() == case_referencia]
        if not texto_filtrado:
            return ""
        menor, maior = min(texto_filtrado), max(texto_filtrado)
    else:
        menor, maior = min(texto), max(texto)

    if menor.isupper():
        esperado = {chr(i) for i in range(ord('A'), ord('Z') + 1) 
                   if chr(i) >= menor and chr(i) <= maior}
    else:
        esperado = {chr(i) for i in range(ord('a'), ord('z') + 1) 
                   if chr(i) >= menor and chr(i) <= maior}

    if menor.isupper():
        texto_compare = texto.upper()
    else:
        texto_compare = texto.lower()
    
    faltantes = [char for char in sorted(esperado) if char not in texto_compare]
    
    return ''.join(faltantes)</code></pre>
            </div>
            <!-- Novo bloco de código adicional -->
            <div class="code-block bg-gray-700 rounded-lg p-4 mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400 font-mono">Python - Código de teste</span>
                    <button onclick="copyCode('code2')"
                        class="bg-gray-600 hover:bg-gray-500 text-white py-1 px-3 rounded-md text-sm flex items-center transition-colors">
                        <i data-feather="copy" class="w-4 h-4 mr-2"></i> Copiar
                    </button>
                </div>
                <pre id="code2"
                    class="language-python line-numbers font-mono text-sm text-gray-200 overflow-x-auto p-4 bg-gray-800 rounded">
<code>if __name__ == "__main__":
    testes = [
        ("abcdf", "e"),
        ("acDf", "be"),
        ("OQrS", "P"),
        ("acdb", ""),
        ("abcz", "defghijklmnopqrstuvwxy"),
    ]

    for entrada, esperado in testes:
        resultado = desafio1(entrada)
        print(f"Entrada: '{entrada}' => Retorno: '{resultado}' (Esperado: '{esperado}')")
        assert resultado == esperado, f"Erro: esperado '{esperado}', obtido '{resultado}'"

    print("Todos os testes passaram!")

</code></pre>
            </div>

            <!-- Bloco do terminal -->
            <div class="mt-4 p-4 bg-gray-800 text-green-400 rounded overflow-x-auto">
                <h3 class="font-bold mb-2 text-gray-200">Retorno no terminal:</h3>
                <pre class="whitespace-pre-wrap break-words"><code>
Entrada: 'abcdf' => Retorno: 'e' (Esperado: 'e')
Entrada: 'acDf' => Retorno: 'be' (Esperado: 'be')
Entrada: 'OQrS' => Retorno: 'P' (Esperado: 'P')
Entrada: 'acdb' => Retorno: '' (Esperado: '')
Entrada: 'abcz' => Retorno: 'defghijklmnopqrstuvwxy' (Esperado: 'defghijklmnopqrstuvwxy')
Todos os testes passaram!
    </code></pre>
            </div>
        </section>

        <!-- Challenge 2 -->
        <section id="challenge2" class="mb-16 challenge-card bg-gray-800 rounded-xl p-6">
            <div class="flex items-center mb-6">
                <div
                    class="w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-teal-600 flex items-center justify-center mr-4">
                    <span class="text-xl font-bold">2</span>
                </div>
                <h2
                    class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-teal-400">
                    Desafio #2
                </h2>
            </div>

            <div class="prose prose-invert max-w-none mb-8">
                <p class="text-gray-300 leading-relaxed">
                    Código para calcular o valor de uma parcela para um empréstimo com taxas variáveis.
                </p>
            </div>

            <!-- Adicionar a classe mb-6 aqui para o espaçamento -->
            <div class="code-block bg-gray-700 rounded-lg p-4 mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400 font-mono">Python</span>
                    <button onclick="copyCode('code2')"
                        class="bg-gray-600 hover:bg-gray-500 text-white py-1 px-3 rounded-md text-sm flex items-center transition-colors">
                        <i data-feather="copy" class="w-4 h-4 mr-2"></i> Copiar
                    </button>
                </div>
                <pre id="code3"
                    class="language-python line-numbers font-mono text-sm text-gray-200 overflow-x-auto p-4 bg-gray-800 rounded"><code>def calcular_amortizacao_taxas_variaveis(L, taxas, b):
    """
    Calcula o valor da parcela (p) para um empréstimo com taxas variáveis.
    
    Parâmetros:
    L (float): Valor do empréstimo (principal)
    taxas (list): Lista das taxas de juros para cada período (ex: [0.01, 0.015, 0.02] para 1%, 1.5%, 2%)
    b (float): Valor do pagamento balão (bullet payment) no final
    
    Retorna:
    float: Valor da parcela constante
    """
    
    n = len(taxas)

    if n == 0:
        raise ValueError("A lista de taxas não pode estar vazia")
    
    produto_taxas = 1.0
    for i in range(n):
        produto_taxas *= (1 + taxas[i])

    numerador = L * produto_taxas - b

    denominador = 1.0
    
    for i in range(1, n): 
        produto_parcial = 1.0
        for j in range(i, n):
            produto_parcial *= (1 + taxas[j])
        denominador += produto_parcial
    
    p = numerador / denominador
    
    return p</code></pre>
            </div>
            <!-- Novo bloco de código adicional -->
            <div class="code-block bg-gray-700 rounded-lg p-4 mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400 font-mono">Python - Código de teste</span>
                    <button onclick="copyCode('code2-teste')"
                        class="bg-gray-600 hover:bg-gray-500 text-white py-1 px-3 rounded-md text-sm flex items-center transition-colors">
                        <i data-feather="copy" class="w-4 h-4 mr-2"></i> Copiar
                    </button>
                </div>
                <pre id="code4"
                    class="language-python line-numbers language-python line-numbers font-mono text-sm text-gray-200 overflow-x-auto p-4 bg-gray-800 rounded">
<code>if __name__ == "__main__":
    # Exemplo: Empréstimo de R$ 100.000, 3 períodos com taxas variáveis
    L = 100000  # Valor do empréstimo
    taxas = [0.01, 0.015, 0.02]  # Taxas: 1%, 1.5%, 2%
    b = 20000  # Pagamento balão no final
    
    parcela = calcular_amortizacao_taxas_variaveis(L, taxas, b)
    
    print(f"Valor do empréstimo: R$ {L:,.2f}")
    print(f"Taxas: {[f'{t*100}%' for t in taxas]}")
    print(f"Pagamento balão: R$ {b:,.2f}")
    print(f"Parcela calculada: R$ {parcela:,.2f}")

</code></pre>
            </div>

            <!-- Bloco do terminal -->
            <div class="mt-4 p-4 bg-gray-800 text-green-400 rounded overflow-x-auto">
                <h3 class="font-bold mb-2 text-gray-200">Retorno no terminal:</h3>
                <pre class="whitespace-pre-wrap break-words"><code>
Valor do empréstimo: R$ 100,000.00
Taxas: ['1.0%', '1.5%', '2.0%']
Pagamento balão: R$ 20,000.00
Parcela calculada: R$ 27,678.23
    </code></pre>
            </div>
        </section>

        <!-- Challenge 3 -->
        <section id="challenge3" class="mb-16 challenge-card bg-gray-800 rounded-xl p-6">
            <div class="flex items-center mb-6">
                <div
                    class="w-12 h-12 rounded-full bg-gradient-to-br from-yellow-500 to-orange-600 flex items-center justify-center mr-4">
                    <span class="text-xl font-bold">3</span>
                </div>
                <h2
                    class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-400">
                    Desafio #3
                </h2>
            </div>

            <div class="prose prose-invert max-w-none mb-8">
                <p class="text-gray-300 leading-relaxed">
                    Para o desafio 3, utilizei a biblioteca que desenvolvi durante meu mestrado, chamada
                    <code>ForestPyTools</code>.
                </p>
                <p class="text-gray-300 leading-relaxed mt-4">
                    A documentação da biblioteca pode ser acessada <a href="https://www.forestpytools.com/"> clicando
                        aqui.</a>
                    Instalar via <code>pip install git+https://github.com/RichterV/fptools.git</code>
                </p>
                <p class="text-gray-300 leading-relaxed mt-4">
                    O primeiro passo é realizar a análise visual dos dados. Logo de cara percebemos que o plantio P-9A
                    possui um outlayer.
                </p>
                <!-- Adicionando imagem do outlayer -->
                <div class="mt-6 flex justify-center">
                    <img src="images/img1.png" alt="Outlayer do plantio P-9A"
                        class="rounded-lg shadow-lg max-w-full h-auto">
                </div>
                <p class="text-gray-300 leading-relaxed mt-4">
                    Como trata-se de apenas um ponto, não terá tanto efeito no ajuste da regressão. Contúdo, é
                    recomendado contatar o responsável pela coleta para verificação dos dados. Se não for possível
                    verificar, recomenda-se excluir a árvore do ajuste. Nesse caso, vou remover o ponto da base de
                    dados.
                </p>
                <p class="text-gray-300 leading-relaxed mt-4">
                    Primeiramente, farei o ajuste da relação hipsométrica para preenchimento das alturas faltantes.
                </p>
            </div>

            <div class="code-block bg-gray-700 rounded-lg p-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400 font-mono">Python</span>
                    <button onclick="copyCode('code3')"
                        class="bg-gray-600 hover:bg-gray-500 text-white py-1 px-3 rounded-md text-sm flex items-center transition-colors">
                        <i data-feather="copy" class="w-4 h-4 mr-2"></i> Copiar
                    </button>
                </div>
                <pre id="code3"
                    class="language-python line-numbers font-mono text-sm text-gray-200 overflow-x-auto p-4 bg-gray-800 rounded"><code>#Importar bibliotecas
from fptools.hyp_rel import HypRel
import pandas as pd
import numpy as np
import warnings

# Desativa warnings
#Minha biblioteca foi feita usando metodos antigos do pandas, o que resulta em warnings. Irei corrigir futuramente.
#Por enquanto manterei desativados
warnings.simplefilter("ignore", category=RuntimeWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)

#leitura dos dados
data = pd.read_csv("BR-SANTAVERONICA-DB-01 - IPC.csv",
                    decimal=",",
                    sep=";", 
                    encoding="latin1")

#Remover dados de árvores mortas e falhas para o ajuste
data = data.fillna(0)
data = data.dropna(how='all')

#Criar coluna única para Talhao-Plantio
data['talhao-plantio'] = data["Talhao"] + '-' + data["Plantio"]

#Eliminando dados desnecessários
data_ajuste = data[['talhao-plantio', "Cap", "Ht"]]

#criando coluna dap
data_ajuste['dap'] = data_ajuste["Cap"] / np.pi

#Fazer ajustes por parcelas (Uma regressão para cada talhao-plantio)
reg = HypRel("dap","Ht", data_ajuste, iterator="talhao-plantio")

results = reg.run()

metrics = reg.view_metrics()  

df_coefficients =  reg.get_coef()

final_results =  reg.predict()

final_results.loc[final_results['dap'] == 0, 'best_predicted_height'] = 0

#Salvar resultado final
final_results.to_excel("rel_hyp.xlsx")</code></pre>
            </div>
            <!-- Bloco do terminal -->
            <div class="mt-4 p-4 bg-gray-800 text-green-400 rounded overflow-x-auto">
                <h3 class="font-bold mb-2 text-gray-200">Retorno no terminal:</h3>
                <pre class="whitespace-pre-wrap break-words"><code>
        model       MAE      MAPE       MSE      RMSE  R squared  Explained Var    Mean Error  score   iterator
0   parabolic  1.215937  4.104179  2.348710  1.532550   0.577344       0.577344  3.090230e-15     10    T-6-P-6
1         ann  1.220735  4.120476  2.370267  1.539567   0.573465       0.573466  1.982210e-03      9    T-6-P-6
2      smd_fm  1.219439  4.112787  2.360271  1.536317   0.575264       0.575877  5.837030e-02      8    T-6-P-6
3    prodan_i  1.224763  4.129802  2.380682  1.542946   0.571591       0.572709  7.883536e-02      7    T-6-P-6
4   prodan_ii  1.224606  4.128220  2.378958  1.542387   0.571901       0.573127  8.253190e-02      6    T-6-P-6
5      curtis  1.253938  4.218145  2.498468  1.580654   0.550395       0.550702  4.133253e-02      5    T-6-P-6
6   henriksen  1.266485  4.272160  2.554595  1.598310   0.540295       0.540295  1.891978e-15      4    T-6-P-6
7      stofel  1.283475  4.322264  2.618042  1.618037   0.528877       0.529210  4.303549e-02      3    T-6-P-6
8   parabolic  1.416645  5.218324  3.194703  1.787373   0.422892       0.422892 -4.652363e-15     10    T-7-P-7
9      smd_fm  1.416299  5.224233  3.214763  1.792976   0.419269       0.419269 -2.647618e-14      9    T-7-P-7
10  henriksen  1.416299  5.224233  3.214763  1.792976   0.419269       0.419269 -3.256654e-15      8    T-7-P-7
11     curtis  1.416541  5.209249  3.200331  1.788947   0.421876       0.422488  5.823830e-02      7    T-7-P-7
12     stofel  1.427595  5.258487  3.251328  1.803144   0.412663       0.413295  5.914052e-02      6    T-7-P-7
13   prodan_i  1.415846  5.192609  3.195324  1.787547   0.422780       0.425281  1.176676e-01      5    T-7-P-7
14  prodan_ii  1.416461  5.193595  3.197261  1.788089   0.422430       0.425198  1.237705e-01      4    T-7-P-7
15        ann  1.811090  6.811027  5.488368  2.342727   0.008553       0.008553 -1.805162e-05      3    T-7-P-7
16        ann  1.238219  4.398166  2.500952  1.581440   0.617169       0.617169  3.447269e-05     10  T-9A-P-9A
17  parabolic  1.264248  4.507689  2.576775  1.605234   0.605563       0.605563  3.085786e-15      9  T-9A-P-9A
18   prodan_i  1.252841  4.448886  2.521423  1.587899   0.614036       0.615450  9.612277e-02      8  T-9A-P-9A
19     smd_fm  1.257611  4.466844  2.551432  1.597320   0.609442       0.610191  6.996911e-02      7  T-9A-P-9A
20  prodan_ii  1.253919  4.452209  2.524856  1.588980   0.613510       0.615082  1.013506e-01      6  T-9A-P-9A
21     curtis  1.317763  4.719495  2.740480  1.655440   0.580504       0.580828  4.602700e-02      5  T-9A-P-9A
22  henriksen  1.331581  4.811994  2.807176  1.675463   0.570294       0.570294 -5.095606e-15      4  T-9A-P-9A
23     stofel  1.376592  4.961454  2.988937  1.728854   0.542471       0.542870  5.105950e-02      3  T-9A-P-9A
24  parabolic  1.058242  4.126229  1.741821  1.319781   0.632556       0.632556  2.102197e-16     10    T-8-P-8
25     smd_fm  1.061251  4.137508  1.746537  1.321566   0.631561       0.631561 -2.812740e-14      9    T-8-P-8
26  henriksen  1.061251  4.137508  1.746537  1.321566   0.631561       0.631561 -4.919142e-15      8    T-8-P-8
27     curtis  1.063981  4.146609  1.746294  1.321474   0.631612       0.631863  3.450162e-02      7    T-8-P-8
28   prodan_i  1.064207  4.140822  1.748147  1.322175   0.631221       0.632214  6.858986e-02      6    T-8-P-8
29  prodan_ii  1.064112  4.139619  1.748373  1.322261   0.631174       0.632277  7.232191e-02      5    T-8-P-8
30     stofel  1.061247  4.123864  1.776933  1.333017   0.625149       0.625390  3.379945e-02      4    T-8-P-8
31        ann  1.066873  4.158988  1.790349  1.338039   0.622319       0.622320 -2.798055e-03      3    T-8-P-8
    </code></pre>
            </div>
            <div class="prose prose-invert max-w-none mb-8">
                <p class="text-gray-300 leading-relaxed">
                    Para cada <code>talhao-plantio</code> um tipo de equação melhor se ajustou.
                </p>
                <p class="text-gray-300 leading-relaxed">
                    No final foi gerado um arquivo com todas alturas estimadas pelo seu melhor modelo.
                </p>
            </div>
            <div class="prose prose-invert max-w-none mb-8">
                <h3 class="text-gray-200">AJUSTE DE EQUAÇÕES VOLUMÉTRICAS</h3>
            </div>
            <div class="prose prose-invert max-w-none mb-8">
                <p class="text-gray-300 leading-relaxed">
                    Utilizando-se dos dados de cubagem, foi ajustado as equações volumétricas para cada talhão.
                </p>
            </div>
            <div class="code-block bg-gray-700 rounded-lg p-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400 font-mono">Python</span>
                    <button onclick="copyCode('code3')"
                        class="bg-gray-600 hover:bg-gray-500 text-white py-1 px-3 rounded-md text-sm flex items-center transition-colors">
                        <i data-feather="copy" class="w-4 h-4 mr-2"></i> Copiar
                    </button>
                </div>
                <pre id="code4"
                    class="language-python line-numbers font-mono text-sm text-gray-200 overflow-x-auto p-4 bg-gray-800 rounded"><code>from fptools.volumetrics import Volumetrics
import pandas as pd

data = pd.read_csv("BR-SANTAVERONICA-DB-02 - Cubagem.csv",
                    decimal=",",
                    sep=";", 
                    encoding="latin1")

#Remover dados de árvores mortas e falhas para o ajuste
data = data.fillna(0)
data = data.dropna(how='all')

#criar objeto da classe
vol = Volumetrics(data, 'Código da Árvore', 'HT', 'DAP',
                      'Altura da secção', 'Diâmetro da secção', 'Espessura da casca')

vol = Volumetrics(df=data, tree_identifier='Código da Árvore',
                  tree_height='HT',
                  tree_dbh ='DAP',
                  segment_height='Altura da secção',
                  segment_diameter= 'Diâmetro da secção',
                  tree_bark='Espessura da casca')
#calcular volumes
volumes = pd.DataFrame(vol.get_volumes(iterator='talhao'))
volumes.to_excel("volumes.xlsx")


#ajuste de equações para volume com casca
#foi salvo um arquivo json e um pkl para cada talhao contendo os coeficientes de regressão e redes neurais respectivamente
metricas = vol.fit_taper_functions(save_dir="",iterator="talhao")
print(metricas)
</code></pre>
            </div>
            <!-- Bloco do terminal -->
            <div class="mt-4 p-4 bg-gray-800 text-green-400 rounded overflow-x-auto">
                <h3 class="font-bold mb-2 text-gray-200">Retorno no terminal:</h3>
                <pre class="whitespace-pre-wrap break-words"><code>iterator      model       MAE       MAPE       MSE      RMSE  R squared  Explained Var  Mean Error  score
0       T-6      kozak  0.388599   9.080079  0.249914  0.499914   0.987660       0.987660    0.001548     10
1       T-6         bi  0.406731   9.859510  0.265243  0.515017   0.986903       0.986911    0.013130      9
2       T-6  schoepfer  0.433274   9.655294  0.293983  0.542202   0.985484       0.985491    0.012338      8
3       T-6    johnson  0.505722  11.231311  0.389994  0.624495   0.980743       0.980749    0.011035      7
4       T-6      matte  0.602250  15.865706  0.603489  0.776845   0.970201       0.972514    0.216427      6
5       T-7         bi  0.427937   8.897387  0.319334  0.565096   0.986932       0.986936   -0.009315     10
6       T-7      kozak  0.439445   9.544549  0.330247  0.574671   0.986486       0.986494    0.014077      9
7       T-7  schoepfer  0.480851  10.550566  0.383376  0.619173   0.984312       0.984312    0.001544      8
8       T-7    johnson  0.588545  13.228832  0.598248  0.773465   0.975519       0.975519    0.001376      7
9       T-7      matte  0.746585  16.104059  0.952968  0.976201   0.961003       0.964248    0.281587      6
10      T-8      kozak  0.326507   5.365463  0.168883  0.410954   0.993413       0.993414    0.005655     10
11      T-8         bi  0.355292   5.514441  0.210285  0.458568   0.991798       0.991851   -0.036856      9
12      T-8  schoepfer  0.431135   6.415152  0.316304  0.562409   0.987663       0.987663   -0.002573      8
13      T-8    johnson  0.594203   9.272028  0.633996  0.796238   0.975272       0.975273   -0.002699      7
14      T-8      matte  0.923440  18.035836  1.288841  1.135271   0.949731       0.954590    0.352927      6

    </code></pre>
            </div>
            <div class="prose prose-invert max-w-none mb-8">
                <p class="text-gray-300 leading-relaxed">
                    Para cada <code>talhao</code> um tipo de equação melhor se ajustou.
                </p>
                <p class="text-gray-300 leading-relaxed">
                    Apesar dos modelos de kozak, bi e ann apresentarem melhor ajustes, algumas inconsistencias foram
                    observadas utilizando esses modelos para os dados em questão. Desse modo, optou-se por usar o modelo
                    de <code>schoepfer</code>. As correções estão em andamento.
                </p>
                <p class="text-gray-300 leading-relaxed">
                    O modelo de <code>schoepfer</code> conseguiu ficar em 3º lugar para todos os talhões, conseguindo um
                    erro médio percentual variando de ≅6% a ≅9% e um R² >98%.
                </p>
            </div>
            <div class="prose prose-invert max-w-none mb-8">
                <h3 class="text-gray-200">ESTIMANDO SORTIMENTOS</h3>
            </div>
            <div class="prose prose-invert max-w-none mb-8">
                <p class="text-gray-300 leading-relaxed">
                    A partir dos ajustes dos modelos é possível estimar a quantidade de produtos e volumes para cada
                    árvores.
                </p>
            </div>
            <pre id="code5"
                class="language-python line-numbers font-mono text-sm text-gray-200 overflow-x-auto p-4 bg-gray-800 rounded"><code>from fptools.assortments import Assortments
import pandas as pd
import numpy as np

#Criar dataframe com especificações do produto
produtos = {
    "Product": ["VCOM5cm"],
    "Length min (m)": [3],
    "Length max (m)": [3],
    "D min (cm)": [5],
    "Loss (cm)": [0.5], #Considera uma perda pela serra de meio centímetro
    "Priority": [1]
}

produtos= pd.DataFrame(produtos)

#Carregar dados do IPC processados
data = pd.read_excel("rel_hyp.xlsx")

#incializar classe de sortimentos
sortimentos = Assortments(produtos, assortments_priority=None)

#Obter sortimentos de acordo com cada talhao, usando ann
talhoes = np.unique(data['Talhao'])
# Lista para armazenar cada trees_df
all_trees = []

for talhao in talhoes:
    data_talhao = data[data['Talhao'] == talhao]
    
    # Usa o modelo do talhao T-8 para o T-9A
    if talhao == 'T-9A':
        nome_modelo = f'taper_functions_coefficients_T-8.json'
        trees_df = sortimentos.get_assortments(
            'schoepfer', nome_modelo, data_talhao, 'dap', 'best_predicted_height',
            stump=0.1, initial_height=None
        )
    else:
        nome_modelo = f'taper_functions_coefficients_{talhao}.json'
        trees_df = sortimentos.get_assortments(
            'schoepfer', nome_modelo, data_talhao, 'dap', 'best_predicted_height',
            stump=0.1, initial_height=None
        )
    
    # Adiciona o DataFrame à lista
    all_trees.append(trees_df)

# Combina todos em um único DataFrame
sortimentos_final = pd.concat(all_trees, ignore_index=True)

sortimentos_final.to_excel("sortimentos_final.xlsx")
                   stump=0.1, initial_height=None)
</code></pre>

            <p class="text-gray-300 leading-relaxed">
                A tabela abaixo pode ser encontrada junto com os arquivos para download, entitulada
                <code>sortimentos_final.xlsx</code>.
            </p>
            <!-- Bloco do terminal -->
            <div class="mt-4 p-4 bg-gray-800 text-gray-200 rounded overflow-x-auto">
                <h3 class="font-bold mb-2 text-gray-200">Tabela Gerada:</h3>
                <table class="min-w-full border border-gray-600">
                    <thead>
                        <tr class="bg-gray-700">
                            <th class="px-4 py-2 border-b border-gray-600">VCOM5cm_quantity</th>
                            <th class="px-4 py-2 border-b border-gray-600">VCOM5cm_volume</th>
                            <th class="px-4 py-2 border-b border-gray-600">comercial_volume</th>
                            <th class="px-4 py-2 border-b border-gray-600">tree_volume</th>
                            <th class="px-4 py-2 border-b border-gray-600">wasted_volume</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">8</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,312830336</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,312830336</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,318782503</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,005952167</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">8</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,318625982</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,318625982</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,324758907</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,006132925</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">6</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,126723561</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,126723561</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,132658726</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,005935165</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">8</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,301270731</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,301270731</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,30684116</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,005570429</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">7</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,214060711</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,214060711</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,222060976</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,008000265</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">7</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,202911575</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,202911575</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,209933367</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,007021792</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">7</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,272302667</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,272302667</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,285448758</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,013146091</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">7</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,243238877</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,243238877</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,253846575</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,010607698</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">7</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,26686138</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,26686138</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,279543664</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,012682284</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">7</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,264691864</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,264691864</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,277187403</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,012495538</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">8</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,257214074</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,257214074</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,266566985</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,009352911</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">6</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,137244702</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,137244702</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,144639172</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,00739447</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">8</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,314520379</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,314520379</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,321627813</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,007107434</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">7</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,260530062</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,260530062</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,273960152</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,01343009</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">7</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,19377059</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,19377059</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,202259906</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,008489316</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">6</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,172837835</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,172837835</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,186454307</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,013616472</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">7</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,219637149</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,219637149</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,22925971</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,00962256</td>
                        </tr>
                        <tr class="bg-gray-800 text-green-400">
                            <td class="px-4 py-2 border-b border-gray-600">5</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,089498078</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,089498078</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,095308186</td>
                            <td class="px-4 py-2 border-b border-gray-600">0,005810108</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="prose prose-invert max-w-none mb-8">
                <h3 class="text-gray-200">RELATÓRIO FINAL</h3>
            </div>
            <p class="text-gray-300 leading-relaxed">
                Tendo todos esses dados disponíveis, posso usar o módulo <code>ForestReport</code> para gerar um resumo
                de produtividade.
            </p>
            <div class="code-block bg-gray-700 rounded-lg p-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400 font-mono">Python</span>
                    <button onclick="copyCode('code3')"
                        class="bg-gray-600 hover:bg-gray-500 text-white py-1 px-3 rounded-md text-sm flex items-center transition-colors">
                        <i data-feather="copy" class="w-4 h-4 mr-2"></i> Copiar
                    </button>
                </div>
                <pre id="code6"
                    class="language-python line-numbers font-mono text-sm text-gray-200 overflow-x-auto p-4 bg-gray-800 rounded"><code>#Importar bibliotecas
from fptools.forest_report import ForestReport
import pandas as pd
import numpy as np

# Criando os dados das categorias de arvores
tipos_de_arvores = {
    "id": [1, 2, 3, 4, 5, 6, 7],
    "name": ["NORMAL", "DOMINANTE", "FALHA", "TORTUOSA", "MORTA", "BIFURCADA ACIMA", "BIFURCADA"],
    "description": [""] * 7,  # Todas as descrições estão vazias
    "commercial_volume": [1, 1, 0, 1, 0, 1, 1],
    "missing_stems": [0, 0, 1, 0, 0, 0, 0]
}

# Criando o DataFrame
tipos_de_arvores = pd.DataFrame(tipos_de_arvores)

#leitura dos dados
data = pd.read_excel("sortimentos_final.xlsx")

# Criar um dicionário de mapeamento: nome -> id
nome_para_id = dict(zip(tipos_de_arvores['name'], tipos_de_arvores['id']))

# Criar a coluna 'categoria_id' em data
data['categoria_id'] = data['Categoria1'].map(nome_para_id)

print(data)

relatorio = ForestReport(data, 'IdParcela', plot_size=400, tree_type='categoria_id', tree_dbh='dap',
                         tree_height='best_predicted_height',group_levels = ['Talhao'], tree_vol_with_bark = 'tree_volume', 
                         tree_vol_without_bark = None)
relatorio.update_tree_types(tipos_de_arvores)


relatorio.get_report(dir=r"", format="xlsx")
</code></pre>
            </div>
            <div class="prose prose-invert max-w-none mb-8">
                <p class="text-gray-300 leading-relaxed">
                    O relatório gerado é extenso e contém médias, minimas, máximas, desvio padrão além de volume
                    comercial
                    para
                    diferentes níveis de classificação.
                </p>
                <p class="text-gray-300 leading-relaxed">
                    Os valores podem ser verificados nos arquivos de download na planilha
                    <code>forest_report.xlsx</code>.
                </p>
                <div class="prose prose-invert max-w-none mb-8">
                    <p class="text-gray-300 leading-relaxed">
                        Os valores resumidos são mostrados abaixo:
                    </p>

                    <table class="table-auto border border-gray-600 text-gray-300">
                        <thead>
                            <tr>
                                <th class="px-4 py-2 border">Rótulos de Linha</th>
                                <th class="px-4 py-2 border">Contagem Distinta de IdParcela</th>
                                <th class="px-4 py-2 border">Soma de VCOM5cm_volume</th>
                                <th class="px-4 py-2 border">Soma de tree_volume</th>
                                <th class="px-4 py-2 border">Área total amostrada</th>
                                <th class="px-4 py-2 border">VCOM5cm/há</th>
                                <th class="px-4 py-2 border">VTCC/há</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="px-4 py-2 border">T-6</td>
                                <td class="px-4 py-2 border">10</td>
                                <td class="px-4 py-2 border">96,5951633</td>
                                <td class="px-4 py-2 border">100,537114</td>
                                <td class="px-4 py-2 border">4000</td>
                                <td class="px-4 py-2 border">241,4879083</td>
                                <td class="px-4 py-2 border">251,342785</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 border">T-7</td>
                                <td class="px-4 py-2 border">10</td>
                                <td class="px-4 py-2 border">80,78062668</td>
                                <td class="px-4 py-2 border">84,22353698</td>
                                <td class="px-4 py-2 border">4000</td>
                                <td class="px-4 py-2 border">201,9515667</td>
                                <td class="px-4 py-2 border">210,5588424</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 border">T-8</td>
                                <td class="px-4 py-2 border">10</td>
                                <td class="px-4 py-2 border">75,08233826</td>
                                <td class="px-4 py-2 border">78,51117912</td>
                                <td class="px-4 py-2 border">4000</td>
                                <td class="px-4 py-2 border">187,7058457</td>
                                <td class="px-4 py-2 border">196,2779478</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 border">T-9A</td>
                                <td class="px-4 py-2 border">10</td>
                                <td class="px-4 py-2 border">84,40118913</td>
                                <td class="px-4 py-2 border">87,92674778</td>
                                <td class="px-4 py-2 border">4000</td>
                                <td class="px-4 py-2 border">211,0029728</td>
                                <td class="px-4 py-2 border">219,8168694</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </section>

        <!-- MAPA -->
        <section id="mapa" class="mb-16 challenge-card bg-gray-800 rounded-xl p-6">
            <div class="flex items-center mb-6">
                <div
                    class="w-12 h-12 rounded-full bg-gradient-to-br from-red-500 to-blue-600 flex items-center justify-center mr-4">
                    <span class="text-xl font-bold">#</span>
                </div>
                <h2
                    class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-teal-400">
                    Mapa
                </h2>
            </div>
            <div class="prose prose-invert max-w-none mb-8">
                <p class="text-gray-300 leading-relaxed">
                    Por fim, para auxiliar o cliente a visualizar a produtividade, podemos gerar um mapa de calor
                    contendo micro-áreas de produtividade baseado no valor de cada parcela.
                </p>
            </div>
            <!-- Aqui adicionamos a imagem -->
            <div class="mb-6">
                <img src="images/mapa.jpg" alt="Descrição da imagem" class="w-full rounded-lg">
            </div>

        </section>
        <section id="download" class="mb-16 bg-gray-800 rounded-xl p-6 text-center">
            <h2 class="text-2xl font-bold text-white mb-4">Para baixar os arquivos utilizados clique aqui</h2>
            <a href="arquivos.zip" download
                class="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                Baixar Arquivos
            </a>
        </section>
        <section id="observacao" class="mb-16 bg-yellow-500 rounded-xl p-6 text-center">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Observações Importantes</h2>
            <p class="text-gray-900 leading-relaxed">
                A biblioteca utilizada foi recentemente publicada e ainda está em fase de testes. Algumas soluções podem
                não funcionar perfeitamente,
                mas toda a equipe (eu) está trabalhando para corrigir eventuais problemas.
                Agradeço à <strong>Treevia</strong> pela oportunidade e pela contribuição dos seus dados, que
                ajudaram na identificação de bugs e melhorias na biblioteca.
            </p>
        </section>



    </main>

    <!-- Copy Notification -->
    <div id="copyNotification" class="copy-notification bg-green-600 text-white px-4 py-2 rounded-md shadow-lg">
        Código copiado!
    </div>

    <script>
        // Initialize feather icons
        feather.replace();

        // Copy code function
        function copyCode(elementId) {
            const codeElement = document.getElementById(elementId);
            const range = document.createRange();
            range.selectNode(codeElement);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();

            // Show notification
            const notification = document.getElementById('copyNotification');
            notification.style.opacity = '1';
            setTimeout(() => {
                notification.style.opacity = '0';
            }, 2000);
        }

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>

</html>